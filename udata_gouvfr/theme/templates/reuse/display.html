{% extends "reuse/display.html" %}

{% block subnav %}
    {% include theme('subnav-community.html') with context %}
{% endblock %}

{% block content %}
{{ super() }}
<section class="community_container">
    <header>
        <div class="container">
            <div class="cover-communaute"></div>
            <div class="page-header">
                <h2>{{ _('Community contributions') }}</h2>
                <small>{{ _('Explore with Datagouv') }}</small>
            </div>
        </div>
    </header>

    <div class="container">

        <h3>{{ _('Discussions') }}</h3>
        <div class="row">
            <div class="col-sm-9 list-group resources-list smaller">
            {% for discussion in discussions|rejectattr('closed') %}
                {% set loop_index = loop.index %}
                {% set baseobject = reuse %}
                {% include theme('dataset/discussion-item.html') with context %}
            {% endfor %}
                <a class="list-group-item add new-discussion"
                    href="#">
                    <div class="format-label pull-left">+</div>
                    <h4 class="list-group-item-heading">
                        {{ _('Start a new discussion') }}
                    </h4>
                </a>
                {% set discussion_length = discussions|rejectattr('closed')|list|length %}
                <div class="list-group-item list-group-form list-group-form-discussion hidden animated" id="discussion-{{ discussion_length + 1 }}">
                    <div class="format-label pull-left">
                        <span>
                            <a href="#discussion-{{ discussion_length + 1 }}">{{ discussion_length + 1 }}</a>
                        </span>
                    </div>
                    <h4 class="list-group-item-heading">
                        {{ _('Starting a new discussion thread') }}
                    </h4>
                    <p class="list-group-item-text">
                        {{ _("You're about to start a new discussion thread. Make sure that a thread about the same topic doesn't exist yet just above. If you want to report an anomaly, please use the dedicated button just under the reuses.") }}
                    </p>
                    <form role="form" class="clearfix animated"
                        data-api-url="{{ url_for('api.discussions', for=reuse.id) }}"
                        data-subject="{{ reuse.id }}">
                        <div class="form-group">
                            <label for="title">{{ _('Title') }}</label>
                            <input type="text" id="title" name="title" class="form-control" required />
                            <label for="comment">{{ _('Comment') }}</label>
                            <textarea id="comment" name="comment" class="form-control" rows="3" required></textarea>
                        </div>
                        <input type="submit" value="{{ _('Start a discussion') }}" class="btn btn-primary btn-block pull-right submit-new-discussion" />
                    </form>
                    {{ current_user|avatar(52, 'resource-owner') }}
                </div>
                <div class="list-group-item list-group-indent list-group-new-message hidden animated" id="discussion-{{ discussion_length + 1 }}-1">
                    <div class="format-label pull-left">
                        <span>
                            <a href="#discussion-{{ discussion_length + 1 }}-1">{{ discussion_length + 1 }}.1</a>
                        </span>
                    </div>
                    <p class="list-group-item-heading"></p>
                    {{ current_user|avatar(52, 'resource-owner') }}
                </div>
            </div>

            <div class="col-sm-3 note">
                <p>{{ _('Discussion between the reusers and the community about this reuse.') }}</p>
            </div>
        </div>
    </div>
</section>
{% endblock %}
