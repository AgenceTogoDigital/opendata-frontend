{% extends theme('layouts/1-column.html') %}
{% from theme('macros/follow.html') import follow_btn with context %}
{% from theme('macros/issues.html') import issues_btn with context %}
{% from theme('macros/integrate.html') import integrate_btn with context %}
{% from theme('macros/breadcrumb.html') import breadcrumb with context %}

{% set meta = {
    'title': reuse.title,
    'description': reuse.description|mdstrip(60)|forceescape,
    'image': reuse.image(external=True),
    'keywords': [_('reuse')] + reuse.tags,
    'robots': 'noindex, nofollow' if reuse.is_hidden else '',
} %}

{% set bundle = 'reuse' %}

{% set body_class = 'reuse-display' %}

{% set community_subtitle = _('Explore with %(certifier)s', certifier=config.SITE_TITLE ) %}

{% block extra_head %}
<link rel="canonical" href="{{ url_for('reuses.show', reuse=reuse) }}" />
<link rel="alternate" type="application/json+oembed" href="{{ url_for('api.oembed', url=reuse.external_url) }}"
    title="{{ reuse.title | urlencode }}" />
{% endblock %}

{% block breadcrumb %}
<li><a href="{{ url_for('reuses.list') }}">{{ _('Reuses') }}</a></li>
<li class="active">{{ reuse.title }}</li>
{% endblock %}

{% block content %}
{{ breadcrumb(self,
    breadcrum_class=breadcrum_class,
    toolbar_class=toolbar_class
) }}

<section class="reuse-container">
    <header class="reuse-header container">
        <div class="row-inline">
            <h1 class="mb-sm">{{ reuse.title }}</h1>
        </div>
        <div class="row-inline">
            {% if reuse.organization %}
            {% set author_name = reuse.organization.name %}
            {% set author_url = url_for('organizations.show', org=reuse.organization) %}
            {% elif reuse.owner %}
            {% set author_name = reuse.owner.fullname %}
            {% set author_url = url_for('users.show', user=reuse.owner) %}
            {% endif %}
            <p class="m-0 text-grey-300">
                {{ _('Published on %(date)s by %(user)s',
                    date=reuse.created_at|dateformat(format='long'),
                    user='<a href="%(url)s" title="%(name)s">%(name)s</a>'|format(
                        name=author_name,
                        url=author_url
                    )|safe
                ) }}
            </p>
            {% if reuse.private %}
            <small class="private" title="{{ _('Private') }}"
                data-n="{{ _('This reuse is private and will not be visible by other users') }}" popover-placement="top"
                popover-trigger="hover">
                {{ _('Private') }}
            </small>
            {% endif %}
            {% if reuse.deleted %}
            <small class="deleted" title="{{ _('Deleted') }}"
                data-n="{{ _('This reuse has been deleted. This will be permanent in the next 24 hours') }}"
                popover-effect="fade" popover-placement="top" popover-trigger="hover">
                {{ _('Deleted') }}
            </small>
            {% endif %}
        </div>
        <div class="row-inline my-md">
            <a href="{{ reuse.url }}" rel="nofollow" class="btn-secondary btn-secondary-blue-400">
                {{ _('See the reuse') }}
            </a>
            <a class="ml-md text-orange-100 f-bold">
                <span class="btn-secondary btn-secondary-orange-100">
                    {% include theme("svg/arrow-right.svg") %}
                </span>
                <span class="ml-md">{{follower|length}} {{_('@@followers')}}</span>
            </a>
        </div>
    </header>
    <section class="reuse-infos my-lg">
        <div class="tabs container">
            <a href="#reuse-producer" role="button" class="tab-panel bg-green-300 tab active"><span
                    class="label">{{ _('@@Réutilisateur') }}</span></a>
            <a href="#reuse-tags" role="button" class="tab-panel bg-green-300 tab"><span
                    class="label">{{ _('@@Mots clés') }}</span></a>
        </div>
        <div class="callout bg-green-300">
            <div class="hagrid">
                <div class="row align-items-center">
                    <div class="col-1">
                        LOGO
                    </div>
                    <div class="col-10 py-xl">
                        <div id="reuse-producer" class="tab-content active">
                            <h2 class="text-white">Etalab</h2>
                            <p class="text-grey-400">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Veniam
                                beatae
                                doloribus sed repudiandae
                                id pariatur, saepe magnam, reprehenderit optio nam amet quis tempore necessitatibus.
                                Exercitationem consequuntur neque vero animi quaerat!</p>
                        </div>
                        <div id="reuse-tags" class="tab-content">
                            <h2>{{ _('@@Informations') }}</h2>
                            <dl class="description-list fs-base">
                                <div>
                                    <dt class="f-bold text-grey-400">{{ _('@@Type') }}</dt>
                                    <dd>
                                        {{reuse.type_label}}
                                    </dd>
                                </div>
                                <div>
                                    <dt class="f-bold text-grey-400">{{ _('@@Mots clés') }}</dt>
                                    <dd>
                                        {% for tag in reuse.tags %}
                                        <a href="{{ url_for('search.index', tag=tag) }}"><span
                                                class="tag">{{tag}}</span></a>
                                        {% endfor %}
                                    </dd>
                                </div>
                            </dl>
                        </div>
                    </div>
                    <div class="col-1">
                        OTHER SHIT
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section class="reuse-image hagrid">
        <img src="{{ reuse.image|placeholder('reuse') }}" class="w-100" alt="{{ reuse.title }}" />
    </section>
    <section class="reuse-content container">
        <div class="row-inline">
            {{ reuse.description|markdown }}
        </div>
        <div class="row-inline mt-xl mb-lg">
            <a href="{{ reuse.url }}" rel="nofollow" class="btn-secondary btn-secondary-blue-400">
                {{ _('See the reuse') }}
            </a>
            <a class="ml-md text-orange-100 f-bold">
                <span class="btn-secondary btn-secondary-orange-100">
                    {% include theme("svg/arrow-right.svg") %}
                </span>
                <span class="ml-md">{{follower|length}} {{_('@@followers')}}</span>
            </a>
        </div>
    </section>
    <section class="reuse-sources container my-lg">
        <div class="row-inline">
            <h2>
                {{ _('Used datasets') }}
                <sup>{{reuse.datasets|length}}</sup>
            </h2>
        </div>
        <ul class="row">
            {% for dataset in reuse.datasets %}
            <li class="col-md-12 col-6">
                <a href="{{ url_for('datasets.show', dataset=dataset) }}" title="{{ dataset.title }}"
                    class="unstyled w-100">
                    {% include theme('dataset/card.html') %}
                </a>
            </li>
            {% endfor %}
        </ul>
        </div>
    </section>
    <section class="reuse-actions container my-hg">
        <div class="row">
            <div class="col-6 col-md-12">
                <h2 class="fs-xxl">{{ _('@@Actions') }}</h2>
                <ul class="nav-list">
                    {% if can_edit %}
                    <li class="my-md">
                        <a class="nav-link"
                            href="{{ url_for('admin.index', path='reuse/{id}/'.format(id=reuse.id)) }}">{{ _('Modifier des informations') }}</a>
                    </li>
                    {% endif %}
                    <li class="my-md">
                        <a href="#" class="nav-link"
                            @click="$refs.discussions.startThread()">{{ _('Contact the producer') }}</a>
                    </li>
                </ul>
            </div>
            <div class="col-6 col-md-12 my-md-lg">
                <h2 class="fs-xxl">{{_('@@Embed')}}</h2>
                <p class="text-grey-300 fs-sm">
                    Embed is cool, embed is life. Lorem ipsum dolor, sit amet consectetur adipisicing elit. Dolore,
                    consectetur adipisicing elit.
                </p>
                {{integrate_btn(reuse)}}
            </div>
        </div>
    </section>
    <section class="community_container bg-grey-400 text-white py-hg" id="community">
        <div class="container">
            <h2 id="community-discussions" class="fs-hg">{{ _('Discussions') }} <sup class="discussions-count">0</sup>
            </h2>
            <div class="row">
                <div class="col-4 col-md-12 text-grey-300">
                    <p>{{ _('Discussion between the organization and the community about this dataset.') }}</p>
                </div>
            </div>
            <discussion-threads ref="discussions" subject-id="{{ reuse.id }}"
                subject-class="{{ reuse.__class__.__name__ }}">
            </discussion-threads>
        </div>
    </section>
    <section class="reuse-xsell container py-hg">
        <h2>{{ _('@@Plus de réutilisations') }}</h2>
        <ul class="row">
            {% for reuse in related_reuses %}
            {% set features = ['preview'] %}
            <li class="col-3 col-md-4">
                <a href="{{ url_for('reuses.show', reuse=reuse) }}" title="{{ reuse.title }}" class="unstyled w-100">
                    {% include theme('reuse/card.html') %}
                </a>
            </li>
            {% endfor %}
        </ul>
    </section>
    {% endblock %}
